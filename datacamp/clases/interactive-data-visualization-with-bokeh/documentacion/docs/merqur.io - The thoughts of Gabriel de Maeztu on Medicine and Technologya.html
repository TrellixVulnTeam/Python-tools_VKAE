<!DOCTYPE html>
<!-- saved from url=(0046)http://merqur.io/2015/11/25/redrawing-a-brain/ -->
<html class="no-js"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>merqur.io - The thoughts of Gabriel de Maeztu on Medicine and Technology</title>
      
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <meta http-equiv="content-language" content="en-gb">
      <meta name="description" content="The thoughts of Gabriel de Maeztu on Medicine and Technology">
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <meta name="google-site-verification" content="I6OKDIYUxvWqPt1TuRWn0GXy0RENSz5p2OY71B7hOC0">
      <link href="./merqur.io - The thoughts of Gabriel de Maeztu on Medicine and Technologya_files/css" rel="stylesheet" type="text/css">
      <link rel="stylesheet" type="text/css" href="./merqur.io - The thoughts of Gabriel de Maeztu on Medicine and Technologya_files/main.css">
      <link href="http://merqur.io/2015/11/25/redrawing-a-brain/atom.xml" type="application/atom+xml" rel="alternate" title="Site ATOM Feed">
  <script async="" src="./merqur.io - The thoughts of Gabriel de Maeztu on Medicine and Technologya_files/analytics.js.descarga"></script><script type="text/javascript" async="" src="./merqur.io - The thoughts of Gabriel de Maeztu on Medicine and Technologya_files/embed.js.descarga"></script><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.2d848eddee1b8c12749b72a04b2b33dc.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.845ead53749f15d0bd8a5ee344c8f06e.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.7b984c87b2825d6651408c24c7a8a583.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.1') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>

  <body><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
    <!--[if lt IE 7]>
        <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <div class="off-canvas">
      <div class="bio">
          <h1>Hi, I'm Gabi.</h1>
          <p>I'm a medical student based in Barcelona and a self-made data scientist. I love Medicine, coding and data mining.</p>
          
          <p>Right now I work in the crosspoint of these amazing fields exploring the deep secrets of the brain thanks to MRI Technology.</p>
          
      </div>
      <h6><a href="http://merqur.io/public_pgp/">Public PGP</a></h6>
      <nav>
        <h6>Find me on</h6>
        <ul>
          
          <li><a target="_blank" href="https://twitter.com/gabimaeztu">Twitter</a></li>
          
          
          <li><a target="_blank" href="https://github.com/merqurio">Github</a></li>
          
          
          <li><a target="_blank" href="https://linkedin.com/in/gabrieldemaeztu">LinkedIn</a></li>
          
          
          
        </ul>
      </nav>
    </div>


    <div class="site-wrapper">

      <header>
        <div class="h-wrap">
          <h1 class="title"><a href="http://merqur.io/" title="Back to Homepage">merqur.io</a></h1>
          <a class="menu-icon" title="Open Bio"><span class="lines"></span></a>
        </div>
      </header>

      <main>
        <section class="single-wrap">
  <article class="single-content" itemscope="" itemtype="http://schema.org/BlogPosting">
    <div class="feat">
      <h5 class="page-date">
        <time datetime="2015-11-25T00:00:00+00:00" itemprop="datePublished">
          25 November 2015
        </time>
      </h5>
    </div>
    <h1 class="page-title" itemprop="name headline">Redrawing a brain with Bokeh</h1>
    <div itemprop="articleBody">
      <script src="./merqur.io - The thoughts of Gabriel de Maeztu on Medicine and Technologya_files/MathJax.js.descarga" id=""></script>

<p>After a <a href="http://merqur.io/2015/10/02/drawing-a-brain-with-bokeh/">first attempt</a> of drawing a <a href="https://en.wikipedia.org/wiki/Connectome">connectome</a> <em>(map of neural connections in the brain)</em>, I came up with a more ambitious idea for a visualization. <strong>Draw one and each of the lines in the square matrix</strong>. We are talking about an average of ±80.000 lines. <a href="http://bokeh.pydata.org/en/latest/">Bokeh</a> seemed to be performant enough in the last visualization I made, with this one, we will see where the actual limits are.</p>

<h3 id="if-not-dots-then-what-">If not dots, then what ?</h3>
<p>Arcs, <a href="http://bokeh.pydata.org/en/latest/docs/reference/models/glyphs.html#bokeh.models.glyphs.Arc">arcs</a> is the answer to that question. If we know the <strong>number of connections in a region</strong> we can figure out the percent that each area <strong>represents in the length of a circumference</strong>; creating each area as an arc scaled with that length, the sum will be a complete circle.</p>

<p>An arc in Bokeh is a glyph and to be drawn needs: <code class="highlighter-rouge">'x', 'y', 'radius', 'start_angle', 'end_angle'</code> and <code class="highlighter-rouge">'direction'</code>. X and Y are the center of my circle (0,0) and the radius will be 1 to make things easier. The <strong>missing values are <code class="highlighter-rouge">start_angle</code> and <code class="highlighter-rouge">end_angle</code></strong> ; with them we will be able to draw the arcs and the circumference.</p>

<h4 id="loading-the-info">Loading the info</h4>

<p>To know the length that each area should have, we need first of all to know the number of connections that each area has.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">connectome</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">'connectome.npy'</span><span class="p">)</span>
<span class="n">weights_of_areas</span> <span class="o">=</span> <span class="p">(</span><span class="n">connectome</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">connectome</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">connectome</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span></code></pre></figure>

<p>Now that we know the number of connections per area, we can know the length that it would represent in a circunference. For that, I will use radians and <strong><em>radius = 1</em></strong> to make operations easier.</p>

<p><img src="./merqur.io - The thoughts of Gabriel de Maeztu on Medicine and Technologya_files/QWwfy.gif" alt=""></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>
<span class="n">areas_in_radians</span> <span class="o">=</span> <span class="p">(</span><span class="n">weights_of_areas</span><span class="o">/</span><span class="n">weights_of_areas</span><span class="o">.</span><span class="nb">sum</span><span class="p">())</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span></code></pre></figure>

<p>If this is this operation was correct, the sum should be near a 2π radians.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">isclose</span>
<span class="n">isclose</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">areas_in_radians</span><span class="o">.</span><span class="nb">sum</span><span class="p">())</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>True
</code></pre>
</div>

<p>An arc of a circle is a “portion” of the circumference of the circle. The length of an arc is simply the length of its “portion” of the circumference. Now that we now the length of each area in a circumference <strong>we need to know the start and end angles</strong> of the arc in order to be able to draw them. The radian measure, <code class="highlighter-rouge">ø</code>, of a central angle of a circle is defined as the ratio of the length of the arc the angle subtends, <code class="highlighter-rouge">s</code>, divided by the radius of the circle, <code class="highlighter-rouge">r</code>.</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2205;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/mfrac&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 16.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.752em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.71em, 1013.75em, 3.21em, -999.998em); top: -2.206em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Main;">∅</span><span class="mo" id="MathJax-Span-4" style="font-family: MathJax_Main; padding-left: 0.294em;">=</span><span class="mfrac" id="MathJax-Span-5" style="padding-left: 0.294em;"><span style="display: inline-block; position: relative; width: 0.585em; height: 0px; margin-right: 0.127em; margin-left: 0.127em;"><span style="position: absolute; clip: rect(3.419em, 1000.42em, 4.127em, -999.998em); top: -4.665em; left: 50%; margin-left: -0.248em;"><span class="mi" id="MathJax-Span-6" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.419em, 1000.42em, 4.127em, -999.998em); top: -3.331em; left: 50%; margin-left: -0.206em;"><span class="mi" id="MathJax-Span-7" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.877em, 1000.59em, 1.169em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.4px solid; width: 0.585em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-8" style="font-family: MathJax_Main; padding-left: 0.294em;">=</span><span class="mfrac" id="MathJax-Span-9" style="padding-left: 0.294em;"><span style="display: inline-block; position: relative; width: 7.335em; height: 0px; margin-right: 0.127em; margin-left: 0.127em;"><span style="position: absolute; clip: rect(3.169em, 1005.71em, 4.335em, -999.998em); top: -4.665em; left: 50%; margin-left: -2.873em;"><span class="mrow" id="MathJax-Span-10"><span class="mi" id="MathJax-Span-11" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-12" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-13" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-14" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-15" style="font-family: MathJax_Math-italic;">h</span><span class="mi" id="MathJax-Span-16" style="font-family: MathJax_Math-italic;">t</span><span class="mtext" id="MathJax-Span-17" style="font-family: MathJax_Main;">&nbsp;</span><span class="mi" id="MathJax-Span-18" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-19" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.044em;"></span></span><span class="mtext" id="MathJax-Span-20" style="font-family: MathJax_Main;">&nbsp;</span><span class="mi" id="MathJax-Span-21" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-22" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-23" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.169em, 1007.17em, 4.335em, -999.998em); top: -3.331em; left: 50%; margin-left: -3.581em;"><span class="mrow" id="MathJax-Span-24"><span class="mi" id="MathJax-Span-25" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-26" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-27" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-28" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-29" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-30" style="font-family: MathJax_Math-italic;">h</span><span class="mtext" id="MathJax-Span-31" style="font-family: MathJax_Main;">&nbsp;</span><span class="mi" id="MathJax-Span-32" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-33" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.044em;"></span></span><span class="mtext" id="MathJax-Span-34" style="font-family: MathJax_Main;">&nbsp;</span><span class="mi" id="MathJax-Span-35" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-36" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-37" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-38" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-40" style="font-family: MathJax_Math-italic;">s</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.877em, 1007.34em, 1.169em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.4px solid; width: 7.335em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-41" style="font-family: MathJax_Main; padding-left: 0.294em;">=</span><span class="mfrac" id="MathJax-Span-42" style="padding-left: 0.294em;"><span style="display: inline-block; position: relative; width: 0.627em; height: 0px; margin-right: 0.127em; margin-left: 0.127em;"><span style="position: absolute; clip: rect(3.419em, 1000.42em, 4.127em, -999.998em); top: -4.665em; left: 50%; margin-left: -0.248em;"><span class="mi" id="MathJax-Span-43" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.21em, 1000.42em, 4.127em, -999.998em); top: -3.331em; left: 50%; margin-left: -0.248em;"><span class="mn" id="MathJax-Span-44" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.877em, 1000.63em, 1.169em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.4px solid; width: 0.627em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.21em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.097em; border-left: 0px solid; width: 0px; height: 2.853em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi mathvariant="normal">∅</mi><mo>=</mo><mfrac><mi>s</mi><mi>r</mi></mfrac><mo>=</mo><mfrac><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>h</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>f</mi><mtext>&nbsp;</mtext><mi>a</mi><mi>r</mi><mi>c</mi></mrow><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>f</mi><mtext>&nbsp;</mtext><mi>r</mi><mi>a</mi><mi>d</mi><mi>i</mi><mi>u</mi><mi>s</mi></mrow></mfrac><mo>=</mo><mfrac><mi>s</mi><mn>1</mn></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-1">\emptyset = \frac{s}{r} = \frac{lenght\ of\ arc}{length\ of\ radius} = \frac{s}{1}</script>

<p>So in this case <code class="highlighter-rouge">ø = s</code> makes everything much easier. Our points must start on zero, so I add a zero in the begining of the array.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">areas_in_radians</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="c"># We add a zero in the begging for the cumsum</span>
<span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">areas_in_radians</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">start_angle</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">end_angle</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></code></pre></figure>

<p>Let’s add some color using the function we already created for the previous connectome.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">colorsys</span> <span class="kn">import</span> <span class="n">hsv_to_rgb</span>
<span class="k">def</span> <span class="nf">gen_color</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="n">golden_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">h</span> <span class="o">+=</span> <span class="n">golden_ratio</span>
    <span class="n">h</span> <span class="o">%=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="s">'#{:02X}{:02X}{:02X}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">)))</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">gen_color</span><span class="p">(</span><span class="n">area</span><span class="o">/</span><span class="n">areas_in_radians</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">areas_in_radians</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span></code></pre></figure>

<h4 id="creating-the-arcs">Creating the arcs</h4>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">output_notebook</span><span class="p">,</span> <span class="n">show</span><span class="p">,</span> <span class="n">figure</span><span class="p">,</span> <span class="n">ColumnDataSource</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">Range1d</span></code></pre></figure>

<p>The easiest way is to create a ColumnDataSource instance with the data we need to create the arcs in order to reuse this same instance later on.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">arcs</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">connectome</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">connectome</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">start</span><span class="o">=</span><span class="n">start_angle</span><span class="p">,</span>
        <span class="n">end</span><span class="o">=</span><span class="n">end_angle</span><span class="p">,</span>
        <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
    <span class="p">)</span></code></pre></figure>

<p>We configure the plot</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Connectomme"</span><span class="p">,</span>
           <span class="n">outline_line_color</span><span class="o">=</span><span class="s">"white"</span><span class="p">,</span>
           <span class="n">toolbar_location</span><span class="o">=</span><span class="s">"below"</span><span class="p">)</span>

<span class="c"># grid configurations</span>
<span class="n">p</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">y_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">p</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">p</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'x'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'y'</span><span class="p">,</span> <span class="n">start_angle</span><span class="o">=</span><span class="s">'start'</span><span class="p">,</span> <span class="n">end_angle</span><span class="o">=</span><span class="s">'end'</span><span class="p">,</span>
      <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s">'colors'</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">arcs</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code></pre></figure>

<p>And print it !</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">output_notebook</span><span class="p">(</span><span class="n">hide_banner</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></code></pre></figure>

<div class="embed-container bokeh">
  <iframe width="420" height="315" frameborder="0" src="./merqur.io - The thoughts of Gabriel de Maeztu on Medicine and Technologya_files/only_arcs.html">
  </iframe>
</div>

<h3 id="i-got-those-arcs-now-what-">I got those arcs, now what ?</h3>
<div class="highlighter-rouge"><pre class="highlight"><code>bokeh.crazy_scientific_mode = True
</code></pre>
</div>

<p>Now let’s get into the real stuff. <strong>Drawing so many lines is not an easy task</strong>, so I did it using <a href="https://en.wikipedia.org/wiki/Object-oriented_programming">OOP</a> to make it more understandable. I’m sure there is someone reading this and thinking, <em>“meh, I can do that without declaring a class”</em> for those; please, do it and share your approach.</p>

<p>We can create each area as an arc with it’s start and end point and the number of connections there should be in that area.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span>
<span class="k">class</span> <span class="nc">Area</span><span class="p">():</span>
    <span class="s">"""
    It represents a brain area. It will create a list of available points throught the arc representing that area and then we will
    use those points as start and end for the beziers.
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_conn</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">=</span> <span class="n">n_conn</span> <span class="c"># Number of connections in that area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_point</span> <span class="o">=</span> <span class="n">start_point</span> <span class="c"># The start point of the arc representing the area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_point</span> <span class="o">=</span> <span class="n">end_point</span>
        <span class="n">free_points_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">,</span> <span class="n">n_conn</span><span class="p">)</span> <span class="c"># Equally spaced points between start point and end point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_points</span> <span class="o">=</span> <span class="p">[[</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)]</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">free_points_angles</span><span class="p">]</span> <span class="c"># A list of available X,Y to consume</span></code></pre></figure>

<p>Now we generate each of the areas in the connectome as an object and store them in a list.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">all_areas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_angle</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">all_areas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Area</span><span class="p">(</span><span class="n">weights_of_areas</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">start_angle</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">end_angle</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span></code></pre></figure>

<p>Each of those areas we just created has all the points(x,y) that the connections will start from or go to. Those points are in the same space than the arcs we defined earlier. That will create the illusion that the lines are created from the arc, as they will share the same color that the arc they were started from.</p>

<p>Now we have to create each of those lines. The easiest thing is just to loop through all the areas and create each connection.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">all_connections</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">region1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">connectome</span><span class="p">):</span>
    <span class="c"># Get the connections origin region</span>
    <span class="n">region_a</span> <span class="o">=</span> <span class="n">all_areas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">weights_of_areas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">n_connections_region2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">region1</span><span class="p">):</span>
        <span class="c"># Get the connection destination region</span>
        <span class="n">region_b</span> <span class="o">=</span> <span class="n">all_areas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_connections_region2</span><span class="p">)):</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">region_a</span><span class="o">.</span><span class="n">free_points</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">region_b</span><span class="o">.</span><span class="n">free_points</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="c"># Get both regions free points and create a connection with the data</span>
            <span class="n">all_connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span> <span class="o">+</span> <span class="p">[</span><span class="n">color</span><span class="p">,</span> <span class="n">weight</span><span class="p">])</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">len</span><span class="p">(</span><span class="n">all_connections</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>4740
</code></pre>
</div>

<p>We have <code class="highlighter-rouge">4740</code> connections in total that we will draw in the plot. Let’s store them in a DataFrame to easily create a ColumnDataSource later on.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">connections_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_connections</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">connections_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">"start_x"</span><span class="p">,</span><span class="s">"start_y"</span><span class="p">,</span><span class="s">"end_x"</span><span class="p">,</span><span class="s">"end_y"</span><span class="p">,</span><span class="s">"colors"</span><span class="p">,</span> <span class="s">"weight"</span><span class="p">]</span></code></pre></figure>

<p>I store the values in the DataFrame as strings to store as many precission as possible. I found that storing them as floats, made me lose lot of precission and bokeh is taking the string values without problems.</p>

<p>Now we create the curves and add them to the DataFrame</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">connections_df</span><span class="p">[</span><span class="s">"cx0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">connections_df</span><span class="o">.</span><span class="n">start_x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">"float64"</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">connections_df</span><span class="p">[</span><span class="s">"cy0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">connections_df</span><span class="o">.</span><span class="n">start_y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">"float64"</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">connections_df</span><span class="p">[</span><span class="s">"cx1"</span><span class="p">]</span> <span class="o">=</span> <span class="n">connections_df</span><span class="o">.</span><span class="n">end_x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">"float64"</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">connections_df</span><span class="p">[</span><span class="s">"cy1"</span><span class="p">]</span> <span class="o">=</span> <span class="n">connections_df</span><span class="o">.</span><span class="n">end_y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">"float64"</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span></code></pre></figure>

<p>We standarize the weights and give them a value that will make them visible. With this, the most important areas will be much more opaque than those with less number of connections.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">connections_df</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">connections_df</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">"float64"</span><span class="p">)</span><span class="o">/</span><span class="n">connections_df</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">"float64"</span><span class="p">)</span><span class="o">.</span><span class="nb">sum</span><span class="p">())</span> <span class="o">*</span> <span class="mi">3000</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">connections_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>start_x</th>
      <th>start_y</th>
      <th>end_x</th>
      <th>end_y</th>
      <th>colors</th>
      <th>weight</th>
      <th>cx0</th>
      <th>cy0</th>
      <th>cx1</th>
      <th>cy1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.988303</td>
      <td>0.152505</td>
      <td>0.96114</td>
      <td>0.276062</td>
      <td>#6779e5</td>
      <td>0.093366</td>
      <td>0.494151</td>
      <td>0.076253</td>
      <td>0.480570</td>
      <td>0.138031</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.988404</td>
      <td>0.151848</td>
      <td>0.961324</td>
      <td>0.275422</td>
      <td>#6779e5</td>
      <td>0.093366</td>
      <td>0.494202</td>
      <td>0.075924</td>
      <td>0.480662</td>
      <td>0.137711</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.988505</td>
      <td>0.15119</td>
      <td>0.918333</td>
      <td>0.395809</td>
      <td>#6779e5</td>
      <td>0.093366</td>
      <td>0.494252</td>
      <td>0.075595</td>
      <td>0.459166</td>
      <td>0.197905</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.988605</td>
      <td>0.150532</td>
      <td>-0.644647</td>
      <td>0.76448</td>
      <td>#6779e5</td>
      <td>0.093366</td>
      <td>0.494303</td>
      <td>0.075266</td>
      <td>-0.322324</td>
      <td>0.382240</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.988705</td>
      <td>0.149873</td>
      <td>-0.64414</td>
      <td>0.764907</td>
      <td>#6779e5</td>
      <td>0.093366</td>
      <td>0.494353</td>
      <td>0.074937</td>
      <td>-0.322070</td>
      <td>0.382454</td>
    </tr>
  </tbody>
</table>
</div>

<p>Once again, using ColumnDataSource I store all the data from the pandas DataFrame in a bokeh compatible object</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Bezier lines</span>
<span class="n">beziers</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">connections_df</span><span class="p">)</span></code></pre></figure>

<p>Aaaaaaand let’s plot it</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Connectomme"</span><span class="p">,</span>
           <span class="n">outline_line_color</span><span class="o">=</span><span class="s">"white"</span><span class="p">,</span>
           <span class="n">toolbar_location</span><span class="o">=</span><span class="s">"below"</span><span class="p">)</span>

<span class="c"># grid configurations</span>
<span class="n">p2</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">y_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">p2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">p2</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">p2</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span></code></pre></figure>

<p>Add the glyphs to the plot…</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p2</span><span class="o">.</span><span class="n">bezier</span><span class="p">(</span><span class="s">'start_x'</span><span class="p">,</span> <span class="s">'start_y'</span><span class="p">,</span> <span class="s">'end_x'</span><span class="p">,</span> <span class="s">'end_y'</span><span class="p">,</span> <span class="s">'cx0'</span><span class="p">,</span> <span class="s">'cy0'</span><span class="p">,</span> <span class="s">'cx1'</span><span class="p">,</span> <span class="s">'cy1'</span><span class="p">,</span>
             <span class="n">source</span><span class="o">=</span><span class="n">beziers</span><span class="p">,</span>
             <span class="n">line_alpha</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span>
             <span class="n">line_color</span><span class="o">=</span><span class="s">'colors'</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'x'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'y'</span><span class="p">,</span> <span class="n">start_angle</span><span class="o">=</span><span class="s">'start'</span><span class="p">,</span> <span class="n">end_angle</span><span class="o">=</span><span class="s">'end'</span><span class="p">,</span>
      <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s">'colors'</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">arcs</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;bokeh.models.renderers.GlyphRenderer at 0x111a7da58&gt;
</code></pre>
</div>

<p>And Voilá !</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">show</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span></code></pre></figure>

<div class="embed-container bokeh">
  <iframe width="420" height="315" frameborder="0" src="./merqur.io - The thoughts of Gabriel de Maeztu on Medicine and Technologya_files/full_connectome.html">
  </iframe>
</div>

<p>Sadly, taking all the connections would make your browser process tooooooo much info when generating the visualization. What you see here is just a rendering of the <code class="highlighter-rouge">connectome[:40][:40]</code> You can try the full visualization with the <a href="http://merqur.io/notebooks/bokeh_brains_v2/BokehBrain.zip">jupyter notebook</a> but use at your own risk ;)</p>

<h3 id="cool-but-some-things-are-still-missing">Cool, but some things are still missing…</h3>
<p>This is a work in progress, working on this visualization I found several limitations in Bokeh.</p>

<ul>
  <li>Add WebGL support for arcs and beziers</li>
  <li>Add HoverTool to arcs to display information on the areas</li>
  <li>Add TapTool to arcs to be able to display only the connections originated from one area</li>
  <li>Create a bokeh interface for Chord graphs</li>
</ul>

<p>I hope that with my time and the help of the community we can get these working. That would give you the ability Chord graphs just by passing an square matrix.
My hope is that in the next several months we can see this integrated inside Bokeh.</p>

<p>Thanks for passing by, you can download all the code <a href="http://merqur.io/notebooks/bokeh_brains_v2/BokehBrain.zip">HERE</a>!</p>

    </div>
    <div class="feat share">
    </div>
    <div id="disqus_thread"><iframe id="dsq-app8743" name="dsq-app8743" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./merqur.io - The thoughts of Gabriel de Maeztu on Medicine and Technologya_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 474px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
    <script type="text/javascript">
      var disqus_identifier = '/2015/11/25/redrawing-a-brain';

      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//merqurio.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the &lt;a href="http://disqus.com/?ref_noscript"&gt;comments powered by Disqus.&lt;/a&gt;</noscript>
    
      <a rel="next" href="http://merqur.io/2016/01/06/lost-in-the-JS-ecosystem/" id="next">
        <span class="nav-title nav-title-next">newer</span> →
      </a>
    
    
      <a rel="prev" href="http://merqur.io/2015/10/02/drawing-a-brain-with-bokeh/" id="prev">
        ← <span class="nav-title nav-title-prev">older</span>
      </a>
    
  </article>
</section>

      </main>

      <footer>
        <small>Gabriel de Maeztu</small>
      </footer>

    </div>
    

    <script src="./merqur.io - The thoughts of Gabriel de Maeztu on Medicine and Technologya_files/main.js.descarga"></script>
    
    
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-25316413-7', 'merqur.io');
        ga('send', 'pageview');
      </script>
    

  

<iframe style="display: none;" src="./merqur.io - The thoughts of Gabriel de Maeztu on Medicine and Technologya_files/saved_resource(2).html"></iframe><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Math-italic, sans-serif;"></div></div></body></html>